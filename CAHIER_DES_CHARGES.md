# ğŸ“‹ CAHIER DES CHARGES COMPLET
## Application de Gestion des Analyses Microbiologiques d'Eau

---

## ğŸ¯ SPÃ‰CIFICATIONS EXACTES

### 1. FORMAT DU DOCUMENT FINAL (.docx)

#### ğŸ“„ Structure du Document

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EN-TÃŠTE (Header)                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ Logo + Titre (Ã  gauche)  â”‚  â”‚  QR Code (droite) â”‚    â”‚
â”‚ â”‚ (image1.jpeg)            â”‚  â”‚                    â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CORPS DU DOCUMENT                                        â”‚
â”‚                                                          â”‚
â”‚ RESULTATS D'ANALYSE MICROBIOLOGIQUE D'EAU               â”‚
â”‚                                                          â”‚
â”‚ Analyse nÂ° : 001/2026                                   â”‚
â”‚ Date de prÃ©lÃ¨vement : 11/01/2026        Lieu : [SAISI]  â”‚
â”‚ Date de rÃ©ception : 13/01/2026                          â”‚
â”‚ IdentitÃ© du prÃ©leveur : [SAISI]                         â”‚
â”‚ IdentitÃ© du demandeur : [SAISI]                         â”‚
â”‚                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ TABLEAU DES PARAMÃˆTRES                              â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚PARAMETRES â”‚TempÃ©ra-  â”‚Technique â”‚RESULTATS â”‚NORMES â”‚ â”‚
â”‚ â”‚           â”‚ture et   â”‚et milieu â”‚UFC/100ml â”‚OMS    â”‚ â”‚
â”‚ â”‚           â”‚temps     â”‚culture   â”‚          â”‚       â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚Coliformes â”‚37Â°C 24h  â”‚Filtrationâ”‚  [X]     â”‚0/100mlâ”‚ â”‚
â”‚ â”‚totaux     â”‚          â”‚membrane  â”‚          â”‚       â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚Coliformes â”‚44Â°C 24h  â”‚Filtrationâ”‚  [X]     â”‚0/100mlâ”‚ â”‚
â”‚ â”‚fÃ©caux     â”‚          â”‚membrane  â”‚          â”‚       â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚Strepto-   â”‚24h       â”‚Filtrationâ”‚  [X]     â”‚0/100mlâ”‚ â”‚
â”‚ â”‚coques     â”‚          â”‚membrane  â”‚          â”‚       â”‚ â”‚
â”‚ â”‚fÃ©caux     â”‚          â”‚          â”‚          â”‚       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚ Conclusion : [CONTENU DE L'Ã‰DITEUR]                     â”‚
â”‚                                                          â”‚
â”‚ NB : [CONTENU DE L'Ã‰DITEUR]                             â”‚
â”‚                                                          â”‚
â”‚ [TITRE SIGNATAIRE - Ex: Le Chef du Laboratoire]         â”‚
â”‚                                                          â”‚
â”‚                                                          â”‚
â”‚ [NOM DU SIGNATAIRE]                                      â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### âš ï¸ IMPORTANT - Ce qui NE doit PAS Ãªtre dans un tableau :
- âŒ Analyse nÂ°
- âŒ Date de prÃ©lÃ¨vement / Lieu
- âŒ Date de rÃ©ception  
- âŒ IdentitÃ© du prÃ©leveur
- âŒ IdentitÃ© du demandeur

Ces informations doivent Ãªtre en **texte simple** (paragraphes).

#### âœ… Ce qui DOIT Ãªtre dans le tableau :
- En-tÃªte : PARAMETRES | TempÃ©rature et temps | Technique | RESULTATS | NORMES
- Ligne 1 : Coliformes totaux
- Ligne 2 : Coliformes fÃ©caux  
- Ligne 3 : Streptocoques fÃ©caux

---

### 2. NUMÃ‰ROTATION UNIQUE

#### Format : `XXX/YYYY`
- XXX = NumÃ©ro sÃ©quentiel sur 3 chiffres (001, 002, ...)
- YYYY = AnnÃ©e en cours (2026)

#### Logique Auto-IncrÃ©mentÃ©e :
```python
def generer_numero():
    annee_actuelle = datetime.now().year
    
    # RÃ©cupÃ©rer ou crÃ©er le compteur pour cette annÃ©e
    counter = DocumentCounter.query.filter_by(year=annee_actuelle).first()
    if not counter:
        counter = DocumentCounter(year=annee_actuelle, counter=0)
        db.session.add(counter)
    
    # IncrÃ©menter
    counter.counter += 1
    db.session.commit()
    
    # Format: 001/2026, 002/2026, etc.
    return f"{counter.counter:03d}/{annee_actuelle}"
```

#### âœ… Garanties :
- Pas de doublon possible
- RÃ©initialisation automatique chaque annÃ©e
- 001/2026, 002/2026, ..., 999/2026
- 001/2027, 002/2027 (nouvelle annÃ©e)

---

### 3. INTERFACE WEB

#### Page 1 : Formulaire de CrÃ©ation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§ª NOUVELLE ANALYSE MICROBIOLOGIQUE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ NumÃ©ro (auto) : [001/2026] (lecture seule, auto-gÃ©nÃ©rÃ©)â”‚
â”‚                                                          â”‚
â”‚ ğŸ“… DATES ET LIEU                                        â”‚
â”‚ Date de prÃ©lÃ¨vement : [____] *                          â”‚
â”‚ Lieu : [________________] * (saisi manuellement)        â”‚
â”‚ Date de rÃ©ception : [____] *                            â”‚
â”‚                                                          â”‚
â”‚ ğŸ‘¥ IDENTITÃ‰S                                            â”‚
â”‚ PrÃ©leveur : [________________] *                        â”‚
â”‚ Demandeur : [________________] *                        â”‚
â”‚                                                          â”‚
â”‚ ğŸ”¬ RÃ‰SULTATS D'ANALYSE (plusieurs Ã©chantillons)        â”‚
â”‚                                                          â”‚
â”‚ Ã‰chantillon 1:                                          â”‚
â”‚   Coliformes totaux (UFC/100ml) : [____]               â”‚
â”‚   Coliformes fÃ©caux (UFC/100ml) : [____]               â”‚
â”‚   Streptocoques fÃ©caux (UFC/100ml) : [____]            â”‚
â”‚   [+ Ajouter un Ã©chantillon]                            â”‚
â”‚                                                          â”‚
â”‚ ğŸ“ CONCLUSION                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [Ã‰diteur Quill]                                     â”‚ â”‚
â”‚ â”‚ Ex: Eau non conforme aux normes bactÃ©riologiques.  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚ ğŸ“ NOTE (NB)                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [Ã‰diteur Quill]                                     â”‚ â”‚
â”‚ â”‚ Ex: Ouvrage Ã  dÃ©sinfecter.                          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚ âœï¸ SIGNATURE                                            â”‚
â”‚ Titre : [Le Chef du Laboratoire] *                     â”‚
â”‚ Nom : [Dr Ibrahim OUEDRAOGO] *                         â”‚
â”‚                                                          â”‚
â”‚ [GÃ©nÃ©rer le Document & QR Code]  [Annuler]             â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Page 2 : Liste des Documents

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“š TOUS LES DOCUMENTS                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ ğŸ” Recherche : [____________] [Rechercher par nÂ°]       â”‚
â”‚                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Document â”‚ Date       â”‚ PrÃ©leveur  â”‚ Actions      â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ 003/2026 â”‚ 28/01/2026 â”‚ SOCREGE    â”‚ ğŸ‘ï¸ ğŸ“¥ ğŸ—‘ï¸    â”‚ â”‚
â”‚ â”‚ 002/2026 â”‚ 27/01/2026 â”‚ CLIENT X   â”‚ ğŸ‘ï¸ ğŸ“¥ ğŸ—‘ï¸    â”‚ â”‚
â”‚ â”‚ 001/2026 â”‚ 26/01/2026 â”‚ SOCIÃ‰TÃ‰ Y  â”‚ ğŸ‘ï¸ ğŸ“¥ ğŸ—‘ï¸    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚ Actions :                                                â”‚
â”‚ ğŸ‘ï¸ = Voir (modal avec dÃ©tails)                          â”‚
â”‚ ğŸ“¥ = TÃ©lÃ©charger DOCX                                    â”‚
â”‚ ğŸ—‘ï¸ = Supprimer (avec confirmation)                      â”‚
â”‚                                                          â”‚
â”‚ âŒ PAS de modification possible (sÃ©curitÃ©)               â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Page 3 : Vue DÃ©tails (Modal)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“„ DÃ‰TAILS DU DOCUMENT 001/2026                 [âœ–ï¸]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ NumÃ©ro : 001/2026                                       â”‚
â”‚ Date de prÃ©lÃ¨vement : 11/01/2026                        â”‚
â”‚ Lieu : BK01 / 11-01-26                                  â”‚
â”‚ Date de rÃ©ception : 13/01/2026                          â”‚
â”‚ PrÃ©leveur : SOCREGE / PROJET BATIE GOLD                 â”‚
â”‚ Demandeur : SOCREGE / PROJET BATIE GOLD                 â”‚
â”‚                                                          â”‚
â”‚ RÃ©sultats :                                              â”‚
â”‚ - Ã‰chantillon 1: CT=34, CF=0, SF=0                      â”‚
â”‚                                                          â”‚
â”‚ Conclusion : Eau non conforme...                        â”‚
â”‚ NB : Ouvrage Ã  dÃ©sinfecter.                             â”‚
â”‚                                                          â”‚
â”‚ Signataire : Dr Ibrahim OUEDRAOGO                       â”‚
â”‚ Titre : Le Chef du Laboratoire                          â”‚
â”‚                                                          â”‚
â”‚ CrÃ©Ã© le : 28/01/2026 Ã  14:30                            â”‚
â”‚                                                          â”‚
â”‚ [TÃ©lÃ©charger DOCX]  [Fermer]                            â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. FONCTIONNALITÃ‰S TECHNIQUES

#### A. GÃ©nÃ©ration du Document DOCX

```python
def generer_docx(document_data):
    """
    GÃ©nÃ¨re le document selon le format exact
    """
    from docx import Document
    from docx.shared import Inches, Pt
    from docx.enum.text import WD_ALIGN_PARAGRAPH
    
    doc = Document()
    
    # 1. EN-TÃŠTE avec logo Ã  gauche et QR Ã  droite
    header = doc.sections[0].header
    header_table = header.add_table(1, 2, width=Inches(7))
    
    # Cellule gauche : Logo + Titre
    left_cell = header_table.rows[0].cells[0]
    left_para = left_cell.paragraphs[0]
    left_run = left_para.add_run()
    left_run.add_picture('image1.jpeg', width=Inches(2.5))
    
    # Cellule droite : QR Code
    right_cell = header_table.rows[0].cells[1]
    right_para = right_cell.paragraphs[0]
    right_para.alignment = WD_ALIGN_PARAGRAPH.RIGHT
    qr_run = right_para.add_run()
    qr_run.add_picture(qr_image_path, width=Inches(1.2))
    
    # 2. TITRE PRINCIPAL
    titre = doc.add_heading('RESULTATS D\'ANALYSE MICROBIOLOGIQUE D\'EAU', 0)
    titre.alignment = WD_ALIGN_PARAGRAPH.CENTER
    
    # 3. INFORMATIONS (HORS TABLEAU)
    doc.add_paragraph(f"Analyse nÂ° : {document_data['numero']}")
    doc.add_paragraph(
        f"Date de prÃ©lÃ¨vement : {document_data['date_prelevement']}"
        f"\t\t\tLieu : {document_data['lieu']}"
    )
    doc.add_paragraph(f"Date de rÃ©ception : {document_data['date_reception']}")
    doc.add_paragraph(f"IdentitÃ© du prÃ©leveur : {document_data['preleveur']}")
    doc.add_paragraph(f"IdentitÃ© du demandeur : {document_data['demandeur']}")
    
    # 4. TABLEAU DES PARAMÃˆTRES
    for resultats in document_data['resultats']:
        table = doc.add_table(rows=4, cols=5)
        table.style = 'Light Grid Accent 1'
        
        # En-tÃªte
        headers = ['PARAMETRES', 'TempÃ©rature\net temps', 
                   'Technique et milieu', 'RESULTATS\nUFC/100 ml', 
                   'NORMES OMS']
        for i, header in enumerate(headers):
            table.rows[0].cells[i].text = header
        
        # Ligne 1: Coliformes totaux
        row1 = table.rows[1].cells
        row1[0].text = 'Â° Recherche et dÃ©nombrement\ndes Coliformes totaux'
        row1[1].text = '37Â°C 24h'
        row1[2].text = 'Filtration sur membrane\nChromocult agar Coliformes'
        row1[3].text = str(resultats['coliformes_totaux'])
        row1[4].text = '0/100 ml'
        
        # Ligne 2: Coliformes fÃ©caux
        # ... (mÃªme structure)
        
        # Ligne 3: Streptocoques fÃ©caux
        # ... (mÃªme structure)
    
    # 5. CONCLUSION
    doc.add_paragraph(f"Conclusion : {document_data['conclusion']}")
    
    # 6. NOTE
    doc.add_paragraph(f"NB : {document_data['note']}")
    
    # 7. SIGNATURE
    doc.add_paragraph(document_data['titre_signataire'])
    doc.add_paragraph()  # Espace pour signature manuscrite
    doc.add_paragraph(document_data['nom_signataire'])
    
    # PAS DE PIED DE PAGE avec URL de vÃ©rification
    
    return doc
```

#### B. Recherche par NumÃ©ro

```python
@app.route('/api/search', methods=['GET'])
def search_document():
    numero = request.args.get('numero')
    
    document = Document.query.filter_by(
        document_number=numero,
        is_active=True
    ).first()
    
    if document:
        return jsonify(document.to_dict())
    else:
        return jsonify({'error': 'Document non trouvÃ©'}), 404
```

#### C. Suppression (sans Modification)

```python
@app.route('/api/delete/<document_id>', methods=['DELETE'])
def delete_document(document_id):
    document = Document.query.get_or_404(document_id)
    
    # Soft delete (marquer comme inactif)
    document.is_active = False
    db.session.commit()
    
    return jsonify({'success': True, 'message': 'Document supprimÃ©'})

# PAS DE ROUTE /api/update - MODIFICATION INTERDITE
```

---

### 5. SÃ‰CURITÃ‰ ET RÃˆGLES MÃ‰TIER

#### âœ… AutorisÃ© :
- CrÃ©er un nouveau document
- Voir la liste complÃ¨te
- Voir les dÃ©tails d'un document
- TÃ©lÃ©charger le DOCX
- Supprimer un document (soft delete)
- Rechercher par numÃ©ro

#### âŒ Interdit :
- Modifier un document existant
- Changer le numÃ©ro
- Restaurer un document supprimÃ© (dans l'interface)

#### ğŸ”’ RÃ¨gles de Validation :
```python
# Tous les champs obligatoires
required_fields = [
    'date_prelevement',
    'lieu',
    'date_reception',
    'identite_preleveur',
    'identite_demandeur',
    'resultats' (au moins 1),
    'conclusion',
    'titre_signataire',
    'nom_signataire'
]

# Note (NB) : optionnel
# NumÃ©ro : auto-gÃ©nÃ©rÃ©, jamais saisi manuellement
```

---

### 6. BASE DE DONNÃ‰ES

#### Table : `documents`
```sql
CREATE TABLE documents (
    id VARCHAR(36) PRIMARY KEY,
    document_number VARCHAR(100) UNIQUE NOT NULL,  -- 001/2026
    date_prelevement DATETIME NOT NULL,
    lieu VARCHAR(200) NOT NULL,
    date_reception DATETIME NOT NULL,
    identite_preleveur VARCHAR(200),
    identite_demandeur VARCHAR(200),
    resultats_json TEXT,  -- JSON: [{ct:34, cf:0, sf:0}, ...]
    conclusion TEXT,
    note TEXT,
    nom_signataire VARCHAR(200),
    titre_signataire VARCHAR(200),
    verification_token VARCHAR(64) UNIQUE NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT TRUE
);
```

#### Table : `document_counter`
```sql
CREATE TABLE document_counter (
    year INTEGER PRIMARY KEY,
    counter INTEGER DEFAULT 0
);
```

---

### 7. FICHIERS Ã€ CRÃ‰ER

```
water_final/
â”œâ”€â”€ app.py                      # Application Flask
â”œâ”€â”€ models.py                   # ModÃ¨les (Document, DocumentCounter)
â”œâ”€â”€ database.py                 # Configuration DB
â”œâ”€â”€ qr_generator.py             # GÃ©nÃ©ration QR Code
â”œâ”€â”€ docx_generator.py           # âœ¨ NOUVEAU: GÃ©nÃ©ration DOCX format exact
â”œâ”€â”€ requirements.txt            # DÃ©pendances
â”œâ”€â”€ init_db.py                  # Initialisation DB
â”‚
â”œâ”€â”€ static/
â”‚   â””â”€â”€ images/
â”‚       â”œâ”€â”€ image1.jpeg         # Logo en-tÃªte (extrait)
â”‚       â”œâ”€â”€ image2.jpeg         # (si nÃ©cessaire)
â”‚       â””â”€â”€ image3.jpeg         # (si nÃ©cessaire)
â”‚
â””â”€â”€ templates/
    â”œâ”€â”€ index.html              # Formulaire de crÃ©ation
    â”œâ”€â”€ liste.html              # Liste des documents
    â””â”€â”€ verification.html       # Page vÃ©rification QR
```

---

### 8. PRIORITÃ‰S D'IMPLÃ‰MENTATION

#### Phase 1 : Base (Essentiel)
1. âœ… ModÃ¨les avec auto-incrÃ©mentation
2. âœ… Formulaire de crÃ©ation
3. âœ… GÃ©nÃ©ration DOCX format exact
4. âœ… QR Code en en-tÃªte

#### Phase 2 : Liste et Recherche
5. âœ… Page liste des documents
6. âœ… Recherche par numÃ©ro
7. âœ… Modal dÃ©tails
8. âœ… TÃ©lÃ©chargement DOCX

#### Phase 3 : Gestion
9. âœ… Suppression (soft delete)
10. âœ… Confirmation suppression
11. âœ… Blocage modification

---

### 9. DIFFÃ‰RENCES CLÃ‰S vs Version PrÃ©cÃ©dente

| Aspect | Avant | Maintenant |
|--------|-------|------------|
| **Infos analyse** | Dans tableau | Hors tableau (paragraphes) |
| **NumÃ©rotation** | Manuelle | Auto: 001/2026, 002/2026... |
| **Lieu** | Non gÃ©rÃ© | Champ sÃ©parÃ© obligatoire |
| **Tableau** | ParamÃ¨tres variÃ©s | Fixe: 3 lignes bactÃ©rio |
| **Pied de page** | URL vÃ©rification | Vide (pas d'URL) |
| **Modification** | AutorisÃ©e | âŒ Interdite |
| **Liste docs** | Absente | âœ… Page complÃ¨te |
| **Recherche** | Absente | âœ… Par numÃ©ro |
| **Signature** | Simple | Titre + Nom |

---

### 10. TESTS Ã€ EFFECTUER

#### âœ… Checklist de Validation

**CrÃ©ation :**
- [ ] NumÃ©ro s'incrÃ©mente automatiquement
- [ ] Pas de doublon possible
- [ ] Tous les champs obligatoires validÃ©s
- [ ] Plusieurs Ã©chantillons gÃ©rÃ©s

**Document DOCX :**
- [ ] Logo en haut Ã  gauche
- [ ] QR Code en haut Ã  droite
- [ ] Infos HORS tableau (paragraphes)
- [ ] Tableau avec 3 lignes exactes
- [ ] Conclusion de l'Ã©diteur
- [ ] NB de l'Ã©diteur
- [ ] Signature (titre + nom)
- [ ] PAS d'URL en pied de page

**Liste :**
- [ ] Tous les documents affichÃ©s
- [ ] Tri par numÃ©ro dÃ©croissant
- [ ] Recherche fonctionne
- [ ] Vue dÃ©tails s'ouvre
- [ ] TÃ©lÃ©chargement DOCX
- [ ] Suppression avec confirmation
- [ ] Pas de bouton "Modifier"

**VÃ©rification QR :**
- [ ] Scan QR ouvre la page
- [ ] Informations affichÃ©es
- [ ] Document invalide dÃ©tectÃ©

---

## ğŸš€ COMMANDES DE DÃ‰MARRAGE

```bash
# Installation
pip install -r requirements.txt

# Initialisation
python init_db.py

# Lancement
python app.py

# Ouvrir
http://localhost:5000
```

---

## ğŸ“ NOTES IMPORTANTES

1. **Image1.jpeg** = Logo principal en-tÃªte
2. **NumÃ©ro auto** = JAMAIS saisi par l'utilisateur
3. **Lieu** = Toujours saisi manuellement (pas auto)
4. **Tableau** = Toujours 3 lignes identiques (structure fixe)
5. **Modification** = INTERDITE (sÃ©curitÃ© documents officiels)
6. **Pied de page** = VIDE (pas d'URL de vÃ©rification)

---

*Cahier des charges crÃ©Ã© le 28 janvier 2026*  
*Version : 3.0 - Analyses Microbiologiques*
